<svg width="1100" height="680" xmlns="http://www.w3.org/2000/svg">
  <style>
    .box { fill:#ffffff; stroke:#0f6a43; stroke-width:2; rx:8; }
    .title { font: 600 16px sans-serif; fill:#0f5132; }
    .text { font: 12px sans-serif; fill:#0f1720; }
    .note { font: 12px sans-serif; fill:#6b7280; }
    .arrow { stroke:#333; stroke-width:1.6; marker-end:url(#arrow); fill:none; }
    .lane { fill:#eaf6f0; stroke:#79b79a; stroke-width:1.5; rx:10; }
  </style>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L9,3 L0,6 Z" fill="#333"/>
    </marker>
  </defs>

  <!-- Swimlanes -->
  <rect x="20" y="20" width="320" height="630" class="lane"/>
  <text x="30" y="40" class="title">Usuario / Telegram</text>

  <rect x="370" y="20" width="320" height="630" class="lane"/>
  <text x="380" y="40" class="title">Validación y Servicios</text>

  <rect x="720" y="20" width="360" height="630" class="lane"/>
  <text x="730" y="40" class="title">Base de Datos y Exportación</text>

  <!-- Steps -->
  <rect x="40" y="70" width="280" height="50" class="box"/>
  <text x="50" y="100" class="text">Comando /get [cantidad] [ubicación] [xlsx|txt]</text>

  <line x1="320" y1="95" x2="370" y2="95" class="arrow"/>

  <rect x="390" y="70" width="280" height="50" class="box"/>
  <text x="400" y="100" class="text">Parseo y reglas (core/validators.py)</text>

  <line x1="670" y1="95" x2="720" y2="95" class="arrow"/>

  <rect x="740" y="70" width="320" height="50" class="box"/>
  <text x="750" y="100" class="text">Validación de disponibilidad (DB)</text>

  <line x1="740" y1="140" x2="430" y2="200" class="arrow"/>
  <rect x="390" y="180" width="280" height="50" class="box"/>
  <text x="400" y="210" class="text">Extracción (ContactService)</text>

  <line x1="670" y1="205" x2="720" y2="205" class="arrow"/>

  <rect x="740" y="180" width="320" height="50" class="box"/>
  <text x="750" y="210" class="text">Consulta optimizada (core/database.py)</text>

  <line x1="740" y1="250" x2="740" y2="300" class="arrow"/>
  <rect x="740" y="300" width="320" height="50" class="box"/>
  <text x="750" y="330" class="text">Marcar contactos como OPTED_OUT</text>
  <text x="750" y="350" class="note">Previene reutilización</text>

  <line x1="740" y1="370" x2="740" y2="420" class="arrow"/>
  <rect x="740" y="420" width="320" height="50" class="box"/>
  <text x="750" y="450" class="text">Exportación (ExportService) → XLSX/TXT</text>

  <line x1="720" y1="445" x2="670" y2="445" class="arrow"/>
  <rect x="390" y="420" width="280" height="50" class="box"/>
  <text x="400" y="450" class="text">Respuesta y auditoría (logger)</text>

  <line x1="370" y1="445" x2="320" y2="445" class="arrow"/>
  <rect x="40" y="420" width="280" height="50" class="box"/>
  <text x="50" y="450" class="text">Entrega de archivo por Telegram</text>

  <line x1="180" y1="480" x2="180" y2="540" class="arrow"/>
  <rect x="40" y="540" width="280" height="50" class="box"/>
  <text x="50" y="570" class="text">Confirmación al usuario</text>

  <!-- Notes -->
  <text x="730" y="610" class="note">Límites: 100–10,000 por extracción • Límite diario sugerido 50,000 • Tamaño máx. archivo Telegram configurable</text>
</svg>
